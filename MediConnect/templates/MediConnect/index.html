{% extends "base.html" %}

{% block title %}Patient Home - MediConnect{% endblock %}

{% block content %}
<section class="hero-section">
    <div class="container text-center">
        <h1 class="display-4 fw-bold">Welcome to MediConnect</h1>
        <p class="lead">Your personal health space for optimal care</p>
        <a href="{% url 'appointment' %}" class="btn btn-light btn-lg">Take an appointment</a>
    </div>
</section>

{% if dashboard_infos %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2 class="text-center mb-4">News and Tips</h2>
                <div class="row g-4">
                    {% for info in dashboard_infos %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">{{ info.title }}</h5>
                                <p class="card-text">{{ info.content }}</p>
                                <span class="badge 
                                    {% if info.category == 'INFO' %}bg-primary
                                    {% elif info.category == 'TIP' %}bg-success
                                    {% elif info.category == 'ALERT' %}bg-danger
                                    {% endif %}">
                                    {{ info.get_category_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 mx-auto">
                {% if pandemic_signals %}
                <h2 class="text-center mb-4">Pandemic Signals</h2>
                <div class="row g-4">
                    {% for signal in pandemic_signals %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">{{ signal.symptom_type }}</h5>
                                <p class="card-text">{{ signal.region }}</p>
                                <span class="badge 
                                    {% if signal.alert_level == 'Low' %}bg-success
                                    {% elif signal.alert_level == 'Medium' %}bg-warning
                                    {% elif signal.alert_level == 'High' %}bg-danger
                                    {% endif %}">
                                    {{ signal.alert_level }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                <h2 class="text-center mb-4 mt-4">Quick Actions</h2>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-calendar-check-fill fs-1 text-primary mb-3"></i>
                                <h5 class="card-title">Describe a case</h5>
                                <p class="card-text">Describe your symptoms</p>
                                <a href="{% url 'submit_case' %}" class="btn btn-primary">Describe a case</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-calendar-check-fill fs-1 text-primary mb-3"></i>
                                <h5 class="card-title">My Appointments</h5>
                                <p class="card-text">Consult and manage your medical appointments.</p>
                                <a href="{% url 'my_appointments' %}" class="btn btn-primary">View my Appointments</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-file-earmark-medical-fill fs-1 text-success mb-3"></i>
                                <h5 class="card-title">My Records</h5>
                                <p class="card-text">Access your medical records and results.</p>
                                <a href="{% url 'my_records' %}" class="btn btn-success">Consult</a>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-chat-dots-fill fs-1 text-info mb-3"></i>
                                <h5 class="card-title">Messages</h5>
                                <p class="card-text">Communicate with your healthcare professionals.</p>
                                <a href="{% url 'my_messages' %}" class="btn btn-info">Messages</a>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
</section>

<section class="bg-light py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <h2>Upcoming Appointments</h2>
                {% if upcoming_appointments %}
                <div class="list-group">
                    {% for appointment in upcoming_appointments %}
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">{{ appointment.doctor.first_name }} {{ appointment.doctor.last_name }} - {{ appointment.doctor.get_role_display }}</h6>
                            <p class="mb-1">{{ appointment.date|date:"d F Y" }} - {{ appointment.time|time:"H:i" }}</p>
                            {% if appointment.notes %}
                            <small class="text-muted">{{ appointment.notes|truncatechars:50 }}</small>
                            {% endif %}
                        </div>
                        <span class="badge bg-primary rounded-pill">Dans {{ appointment.date|timeuntil }}</span>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No scheduled appointments.</p>
                {% endif %}
            </div>
            <div class="col-lg-6">
                <h2>Recent Records</h2>
                {% if recent_records %}
                <div class="list-group">
                    {% for record in recent_records %}
                    <div class="list-group-item">
                        <h6 class="mb-1">{{ record.diagnosis }}</h6>
                        <p class="mb-1">{{ record.date|date:"d F Y" }} - {{ record.doctor.first_name }} {{ record.doctor.last_name }}</p>
                        {% if record.treatment %}
                        <small class="text-muted">Traitement: {{ record.treatment|truncatechars:50 }}</small>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No recent medical records.</p>
                {% endif %}
            </div>
        </div>
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2 class="text-center mb-4">Recent Messages</h2>
                {% if recent_messages %}
                <div class="row g-4">
                    {% for message in recent_messages %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card {% if not message.is_read %}border-primary{% endif %}">
                            <div class="card-body">
                                <h6 class="card-title">{{ message.subject }}</h6>
                                <p class="card-text">{{ message.content|truncatechars:100 }}</p>
                                <small class="text-muted">De: {{ message.sender.first_name }} {{ message.sender.last_name }} - {{ message.created_at|date:"d F Y H:i" }}</small>
                                {% if not message.is_read %}
                                <span class="badge bg-primary">Nouveau</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-center text-muted">No recent messages.</p>
                {% endif %}
            </div>
        </div>
    </div>
</section>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2 class="text-center mb-4">Health Statistics</h2>
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="text-primary">{{appointments_this_year}}</h3>
                                <p>Appointments this year</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="text-success">{{attendance_rate}}%</h3>
                                <p>Attendance rate</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="text-info">  {{doctors.count}}</h3>
                                <p>Doctors consulted</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="text-warning">{{pending_exams}}</h3>
                                <p>Pending exams</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}